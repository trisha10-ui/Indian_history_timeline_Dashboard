<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indian History Timeline | Home</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="custom.css" rel="stylesheet"> 
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
        <div class="container">
            <a class="navbar-brand" href="index.html">ðŸ‡®ðŸ‡³ History Dashboard</a>
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link active" href="index.html">Timeline</a></li>
                    <li class="nav-item"><a class="nav-link" href="eras.html">Era Summaries</a></li>
                    <li class="nav-item"><a class="nav-link" href="artifacts.html">Key Figures</a></li>
                    <li class="nav-item"><a class="nav-link" href="references.html">References</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <header class="bg-light p-5 mb-5 border-bottom">
        <div class="container text-center">
            <h1 class="display-5 fw-bold text-primary">The Sweep of Indian History</h1>
            <p class="lead">From the Indus Valley to the Modern Republic. Data loaded from **Excel.csv**.</p>
        </div>
    </header>

    <div class="container">
        <h2 class="mb-5 text-center">Pivotal Historical Events</h2>
        <div id="timeline-container">
            <div class="text-center p-5 text-muted">Loading timeline data...</div>
        </div>
    </div>

    <footer class="bg-dark text-white text-center p-3 mt-5">
        <p class="mb-0">Mini Project - Static Website using Excel, HTML, CSS, Bootstrap</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // *** IMPORTANT: File name is Excel.csv ***
        const CSV_FILE = 'Excel.csv'; 
        const timelineContainer = document.getElementById('timeline-container');

        // Function to sanitize text (removes breaks/commas that break description box)
        const cleanText = (text) => {
            if (!text) return '';
            // Remove internal quotes, line breaks, and excessive white space
            return text.replace(/"/g, 'â€œ').replace(/\n/g, ' ').replace(/\r/g, ' ').replace(/ {2,}/g, ' ').trim();
        };

        async function loadTimelineData() {
            try {
                const response = await fetch(CSV_FILE);
                const csvText = await response.text();
                
                // Simple CSV parsing
                const lines = csvText.split('\n').filter(line => line.trim() !== '');
                const headers = lines[0].split(',').map(h => h.trim());
                const data = lines.slice(1).map(line => {
                    const values = line.split(',');
                    let obj = {};
                    headers.forEach((header, i) => {
                        obj[header] = values[i] ? values[i].trim() : '';
                    });
                    return obj;
                });
                
                renderTimeline(data);
                
            } catch (error) {
                console.error('Error loading CSV data:', error);
                timelineContainer.innerHTML = '<p class="text-danger text-center">FATAL ERROR: Failed to load data. Check if **Excel.csv** exists and is correctly formatted.</p>';
            }
        }

        function renderTimeline(data) {
            let html = '';
            timelineContainer.innerHTML = ''; 

            data.forEach((item, index) => {
                const isOdd = index % 2 !== 0; 
                const eraClass = item.EraTag ? item.EraTag.toLowerCase().replace(/\s/g, '-') : 'default'; 
                
                // --- CAROUSEL / IMAGE LOGIC ---
                const imageLinks = item.ImageLink ? item.ImageLink.split('|') : [];
                let imageContentHtml = '';

                if (imageLinks.length > 0 && imageLinks[0].trim() !== '') {
                    // *** DIAGNOSTIC LINE ***
                    // If an image link is present, print the expected path to the console.
                    console.log("Expected image path for event", index + ":", "images/" + imageLinks[0].trim()); 
                }

                if (imageLinks.length > 1) {
                    // Generate CAROUSEL HTML for multiple images
                    let carouselIndicators = '';
                    let carouselItems = '';
                    const uniqueId = `carousel-${index}`; 
                    
                    imageLinks.forEach((link, i) => {
                        carouselIndicators += `<button type="button" data-bs-target="#${uniqueId}" data-bs-slide-to="${i}" class="${i === 0 ? 'active' : ''}" aria-current="${i === 0 ? 'true' : 'false'}" aria-label="Slide ${i + 1}"></button>`;
                        
                        carouselItems += `<div class="carousel-item ${i === 0 ? 'active' : ''}">
                            <img src="/images/${imageLinks[0].trim()}" class="d-block w-100 rounded" alt="Event Image ${i + 1}">
                        </div>`;
                    });

                    imageContentHtml = `
                        <div id="${uniqueId}" class="carousel slide mt-3" data-bs-ride="carousel">
                            <div class="carousel-indicators">${carouselIndicators}</div>
                            <div class="carousel-inner">${carouselItems}</div>
                            <button class="carousel-control-prev" type="button" data-bs-target="#${uniqueId}" data-bs-slide="prev">
                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Previous</span>
                            </button>
                            <button class="carousel-control-next" type="button" data-bs-target="#${uniqueId}" data-bs-slide="next">
                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Next</span>
                            </button>
                        </div>
                    `;

                } else if (imageLinks.length === 1 && imageLinks[0].trim() !== '') {
                    // SINGLE IMAGE
                    imageContentHtml = `<img src="images/${imageLinks[0].trim()}" class="img-fluid rounded mt-3" style="max-height: 150px;" alt="${item.EventSummary} image">`;
                }
                
                // --- HTML TEMPLATE GENERATION ---
                html += `
                    <div class="row timeline-item align-items-center mb-5">
                        <div class="col-md-3 ${isOdd ? 'order-md-3' : 'order-md-1'}">
                            <div class="timeline-date text-md-end text-center p-2">
                                <h3>${item.Year}</h3> 
                                <p class="text-muted">${item.EraTag}</p>
                            </div>
                        </div>

                        <div class="col-md-1 d-none d-md-block order-md-2">
                            <div class="timeline-dot rounded-circle mx-auto my-3 dot-significance-${item.Significance}"></div>
                        </div>

                        <div class="col-md-8 ${isOdd ? 'order-md-1' : 'order-md-3'}">
                            <div class="card shadow-sm border-0 card-significance-${item.Significance} era-card-${eraClass}">
                                <div class="card-body">
                                    <span class="badge bg-secondary mb-2">${item.EraTag}</span> 
                                    <h4 class="card-title text-primary">${item.EventSummary}</h4> 
                                    
                                    <p class="card-text">${cleanText(item.FullDescription)}</p>
                                    
                                    ${imageContentHtml} 
                                    
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            timelineContainer.innerHTML = html;
        }

        document.addEventListener('DOMContentLoaded', loadTimelineData);
    </script>
</body>
</html>